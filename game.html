<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Overview - Exeloth Codex</title>
    
    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/game.css">
    
    <style>
        /* Custom styles untuk game page dengan Firebase-style sidebar */
        body.game-page {
            display: flex;
            min-height: 100vh;
            background-color: #34353a;
        }
        
        /* Main content wrapper styling */
        .main-content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* Game header section */
        .game-header-section {
            margin-bottom: 30px;
        }
        
        /* Story sections spacing */
        .story-section {
            margin-bottom: 3rem;
        }
        
        /* Chapter card improvements */
        .chapter-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chapter-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
            border-left-color: var(--primary-color);
            border-color: rgba(111, 66, 193, 0.3);
        }
        
        .chapter-title {
            font-weight: 600;
            color: white;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        
        .chapter-excerpt {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* Badge styling */
        .game-badge {
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        /* Favorite button */
        .btn-favorite {
            transition: all 0.3s ease;
            border: 1px solid #ff6b6b;
            background: transparent;
            color: #ff6b6b;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 50px;
        }
        
        .btn-favorite.active {
            background-color: #ff6b6b;
            color: white;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.4);
            border-color: #ff6b6b;
        }
        
        /* Story section title */
        .story-section-title {
            color: white;
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary-color);
        }
        
        /* Modal customization */
        .modal-game .modal-content {
            background: rgba(33, 37, 41, 0.98);
            border: 1px solid rgba(111, 66, 193, 0.5);
            backdrop-filter: blur(10px);
        }
        
        /* Character modal styling */
        .character-modal .character-content {
            font-size: 1rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* Responsive adjustments */
        @media (max-width: 767.98px) {
            .game-header-section {
                margin-top: 10px;
            }
            
            .chapter-card {
                padding: 1rem;
            }
            
            #game-logo {
                height: 50px;
            }
            
            .story-section-title {
                font-size: 1.5rem;
            }
        }
        
        /* Section highlight animation */
        .section-highlight {
            animation: highlightSection 2s ease;
        }
        
        @keyframes highlightSection {
            0% { background-color: transparent; }
            10% { background-color: rgba(111, 66, 193, 0.1); }
            100% { background-color: transparent; }
        }
        
        /* Game badges container */
        #game-badges {
            min-height: 40px;
        }
        
        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            vertical-align: text-bottom;
            border: 0.25em solid currentColor;
            border-right-color: transparent;
            border-radius: 50%;
            animation: spinner-border .75s linear infinite;
        }
        
        @keyframes spinner-border {
            to { transform: rotate(360deg); }
        }
        
        /* Card hover effects */
        .card.bg-dark {
            transition: all 0.3s ease;
        }
        
        .card.bg-dark:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border-color: rgba(111, 66, 193, 0.3);
        }
    </style>
</head>
<body class="game-page sidebar-persistent">

    <!-- Sidebar Persistent (Firebase-style) -->
    <nav id="sidebar" role="navigation" aria-label="Table of Contents">
        <div class="sidebar-header">
            <div class="sidebar-brand fw-bold text-uppercase ls-1 text-white">DAFTAR ISI</div>
            <button id="dismiss" class="btn btn-sm btn-outline-light rounded-circle d-flex align-items-center justify-content-center" 
                    style="width: 35px; height: 35px; border: 1px solid rgba(255,255,255,0.3);"
                    aria-label="Close sidebar"
                    title="Tutup sidebar">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>

        <div class="sidebar-scrollable">
            <ul class="list-unstyled sidebar-menu py-2">
                <li>
                    <a href="#overview" 
                       class="active d-flex align-items-center gap-3 py-3 px-4" 
                       data-target="overview"
                       aria-label="Go to Overview section">
                        <i class="bi bi-info-circle"></i> 
                        <span>Overview</span>
                    </a>
                </li>
                <li>
                    <a href="#main-story" 
                       class="d-flex align-items-center gap-3 py-3 px-4" 
                       data-target="main-story"
                       aria-label="Go to Main Story section">
                        <i class="bi bi-book"></i> 
                        <span>Cerita Utama</span>
                    </a>
                </li>
                <li>
                    <a href="#character-story" 
                       class="d-flex align-items-center gap-3 py-3 px-4" 
                       data-target="character-story"
                       aria-label="Go to Character Story section">
                        <i class="bi bi-people"></i> 
                        <span>Cerita Karakter</span>
                    </a>
                </li>
                <li>
                    <a href="#event-story" 
                       class="d-flex align-items-center gap-3 py-3 px-4" 
                       data-target="event-story"
                       aria-label="Go to Event Story section">
                        <i class="bi bi-calendar-event"></i> 
                        <span>Cerita Event</span>
                    </a>
                </li>
                <li>
                    <a href="#lore-archive" 
                       class="d-flex align-items-center gap-3 py-3 px-4" 
                       data-target="lore-archive"
                       aria-label="Go to Lore Archive section">
                        <i class="bi bi-archive"></i> 
                        <span>Arsip Lore</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="sidebar-footer p-3 border-top border-secondary">
            <a href="games.html" 
               class="text-decoration-none text-white-50 d-flex align-items-center gap-2"
               onclick="if(window.innerWidth < 768) closeSidebar();">
                <i class="bi bi-arrow-left"></i> 
                <span>Kembali ke Daftar</span>
            </a>
        </div>
    </nav>

    <!-- Main Content Area (sebelah kanan sidebar - Firebase style) -->
    <div id="content">
        <!-- Background tetap -->
        <div class="bg-custom-fixed"></div>

        <!-- Overlay untuk sidebar mobile -->
        <div class="overlay-sidebar" role="button" aria-label="Close sidebar" tabindex="0"></div>

        <!-- Navbar (di dalam content area, di sebelah kanan sidebar) -->
        <div id="navbar-placeholder"></div>
        <script src="assets/js/navbar.js"></script>
        <script>renderNavbar();</script>

        <!-- Main Content Wrapper (yang mendapat padding) -->
        <div class="main-content-wrapper">
            <!-- Game Header -->
            <div class="game-header-section d-flex justify-content-between align-items-center mb-4">
                <img src="assets/img/games/logo-wuthering-waves.jpg" alt="Wuthering Waves Logo" 
                     id="game-logo" 
                     style="height: 60px; width: auto; object-fit: contain;"
                     onerror="this.src='https://ui-avatars.com/api/?name=Wuthering+Waves&background=6f42c1&color=fff'">
                <button class="btn btn-favorite rounded-pill px-4" id="favorite-btn" onclick="toggleFavorite()"
                        aria-label="Add to favorites">
                    <i class="bi bi-star me-2" id="favorite-icon"></i> 
                    <span id="favorite-text">Favorit</span>
                </button>
            </div>
            
            <!-- Game Content Container -->
            <div id="game-content">
                <div class="text-center mb-5">
                    <h1 class="fw-bold mb-2 text-white" id="game-title">Loading Game...</h1>
                    <div id="game-badges" class="d-flex justify-content-center flex-wrap gap-2 mb-4"></div>
                    <p class="lead text-white-50" id="game-description">Loading description...</p>
                </div>
                
                <!-- Overview Section -->
                <section id="overview" class="story-section">
                    <h2 class="story-section-title"><i class="bi bi-info-circle me-2"></i>Overview</h2>
                    <div class="row">
                        <div class="col-md-4 mb-4">
                            <div class="card bg-dark border-secondary h-100">
                                <div class="card-body">
                                    <h5 class="card-title text-white"><i class="bi bi-calendar-event me-2"></i>Release Info</h5>
                                    <p class="card-text text-white-50" id="release-info">Loading...</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card bg-dark border-secondary h-100">
                                <div class="card-body">
                                    <h5 class="card-title text-white"><i class="bi bi-controller me-2"></i>Genre</h5>
                                    <p class="card-text text-white-50" id="game-genre">Loading...</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card bg-dark border-secondary h-100">
                                <div class="card-body">
                                    <h5 class="card-title text-white"><i class="bi bi-globe me-2"></i>Platform</h5>
                                    <p class="card-text text-white-50" id="game-platform">Loading...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Main Story Section -->
                <section id="main-story" class="story-section">
                    <h2 class="story-section-title"><i class="bi bi-book me-2"></i>Cerita Utama</h2>
                    <div id="main-story-content">
                        <div class="text-center text-white-50 py-4">
                            <div class="loading-spinner text-primary" role="status"></div>
                            <p class="mt-2">Memuat cerita...</p>
                        </div>
                    </div>
                </section>
                
                <!-- Character Story Section -->
                <section id="character-story" class="story-section">
                    <h2 class="story-section-title"><i class="bi bi-people me-2"></i>Cerita Karakter</h2>
                    <div id="character-story-content">
                        <div class="text-center text-white-50 py-4">
                            <p>Belum ada konten untuk bagian ini.</p>
                        </div>
                    </div>
                </section>
                
                <!-- Event Story Section -->
                <section id="event-story" class="story-section">
                    <h2 class="story-section-title"><i class="bi bi-calendar-event me-2"></i>Cerita Event</h2>
                    <div id="event-story-content">
                        <div class="text-center text-white-50 py-4">
                            <p>Belum ada konten untuk bagian ini.</p>
                        </div>
                    </div>
                </section>
                
                <!-- Lore Archive Section -->
                <section id="lore-archive" class="story-section">
                    <h2 class="story-section-title"><i class="bi bi-archive me-2"></i>Arsip Lore</h2>
                    <div id="lore-archive-content">
                        <div class="text-center text-white-50 py-4">
                            <p>Belum ada konten untuk bagian ini.</p>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- Footer (di dalam content area) -->
        <footer class="bg-darker py-4 mt-5 border-top border-secondary">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Exeloth Codex</h5>
                        <p class="text-muted small">Community guides for gacha game fans</p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p class="mb-0 text-muted small">Â© 2024 Exeloth Codex â€” All rights reserved.</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Notification Container -->
    <div id="notification-container" class="position-fixed top-0 end-0 p-3" style="z-index: 10000;"></div>

    <!-- Chapter Detail Modal -->
    <div class="modal fade" id="chapterModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content bg-dark text-white border-secondary modal-game">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="chapterModalTitle">Chapter Title</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="chapterModalContent">
                    <div class="text-center py-5">
                        <div class="loading-spinner text-primary" role="status"></div>
                        <p class="mt-3">Memuat konten...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/auth-system.js"></script> 
    <script src="assets/js/app.js"></script>
    
    <!-- Game UI JavaScript -->
    <script src="assets/js/game-ui.js"></script>
    
    <!-- Game Page Specific JavaScript -->
    <script>
        // Data statis untuk Wuthering Waves (fallback)
        const staticGamesData = {
            'wuthering-waves': {
                title: "Wuthering Waves",
                slug: "wuthering-waves",
                description: "Wuthering Waves adalah game aksi open-world dengan sistem pertarungan berbasis resonansi. Jelajahi dunia pasca-apokaliptik yang luas, temukan misteri di balik bencana 'Lament', dan bangun hubungan dengan Resonator lain.",
                thumbnailURL: "assets/img/games/wuthering-waves.jpg",
                logoURL: "assets/img/games/logo-wuthering-waves.jpg",
                status: "New Release",
                releaseDate: "22 Mei 2024",
                genre: "Action RPG, Open World, Gacha",
                platform: "PC, iOS, Android",
                badges: ["New Release", "Open World", "Action", "Gacha", "Free-to-play"],
                mainStory: [
                    {
                        id: 1,
                        title: "Prologue: The Awakening",
                        excerpt: "Kamu terbangun di tengah reruntuhan peradaban lama. Dunia telah berubah, dan kamu harus menemukan jawaban tentang siapa dirimu sebenarnya.",
                        content: `<h3>Prologue: The Awakening</h3>
                                <p>Matahari terbit di atas reruntuhan kota tua, memancarkan cahaya keemasan melalui celah-celah bangunan yang telah hancur. Kamu terbaring di atas puing-puing, tubuh terasa berat dan pikiran berkabut.</p>
                                <p>Suara gemerisik membuatmu terbangun sepenuhnya. Seekor makhluk aneh dengan tubuh transparan dan mata merah mendekat. Insting bertahan hidup membuatmu berdiri, dan tanpa sadar tanganmu memancarkan energi resonansi.</p>
                                <p>"Kamu akhirnya bangun," suara perempuan terdengar dari balik pilar. Seorang perempuan dengan pakaian putih muncul, matanya memancarkan kekhawatiran. "Aku Rover. Dan kamu... kamu Resonator baru."</p>
                                <p>Dunia di sekitarmu perlahan mulai masuk ke dalam ingatanmu. Ini adalah era pasca-Lament, sebuah bencana yang mengubah segalanya. Kamu memiliki kekuatan resonansi, kemampuan langka yang bisa berinteraksi dengan gelombang suara dunia.</p>
                                <div class="mt-4 p-3 bg-dark rounded">
                                    <small class="text-white-50"><i class="bi bi-info-circle me-1"></i> <strong>Catatan Lore:</strong> Lament adalah peristiwa besar yang mengubah struktur dunia, menyebabkan munculnya Tacet Discord dan energi resonansi tidak stabil.</small>
                                </div>`
                    },
                    {
                        id: 2,
                        title: "Chapter 1: Echoes of Huanglong",
                        excerpt: "Perjalanan ke kota Huanglong mengungkap rahasia pertama tentang asal usul Lament dan kekuatan resonansi.",
                        content: `<h3>Chapter 1: Echoes of Huanglong</h3>
                                <p>Kota Huanglong berdiri megah di tengah dataran tinggi, arsitekturnya memadukan teknologi canggih dengan estetika tradisional. Rover membawamu melalui gerbang kota, menjelaskan bahwa Huanglong adalah salah satu dari sedikit tempat yang relatif aman setelah Lament.</p>
                                <p>"Di sini kamu bisa belajar mengendalikan resonansimu," kata Rover sambil menunjuk menara tinggi di tengah kota. "Itu Menara Bel, tempat para Resonator berlatih."</p>
                                <p>Pertemuan dengan Jiyan, komandan Pengawal Huanglong, membuka mata tentang situasi yang sebenarnya. Dunia masih penuh dengan Tacet Discord, makhluk yang lahir dari energi resonansi yang tidak stabil.</p>
                                <p>"Lament bukan hanya bencana," ujar Jiyan dengan suara serius. "Itu adalah perubahan mendasar pada alam semesta kita. Gelombang suara yang biasa sekarang membawa kekuatan dan bahaya."</p>
                                <div class="mt-4 p-3 bg-dark rounded">
                                    <small class="text-white-50"><i class="bi bi-geo-alt me-1"></i> <strong>Lokasi:</strong> Huanglong - Kota benteng utama yang selamat dari Lament, menjadi pusat perlindungan bagi para Resonator.</small>
                                </div>`
                    },
                    {
                        id: 3,
                        title: "Chapter 2: Whispers of the Past",
                        excerpt: "Eksplorasi ke reruntuhan kuno mengungkap kebenaran tentang peradaban sebelum Lament.",
                        content: `<h3>Chapter 2: Whispers of the Past</h3>
                                <p>Reruntuhan peradaban lama menyimpan banyak rahasia. Bersama Rover, kamu menjelajahi situs arkeologi di pinggiran Huanglong. Tablet-tablet kuno yang ditemukan menceritakan kisah tentang "Era Resonansi", zaman ketika manusia pertama kali menemukan kekuatan gelombang suara.</p>
                                <p>"Mereka bukan hanya menggunakannya," teriak Rover dari balik tumpukan batu. "Mereka menyatu dengan resonansi!"</p>
                                <p>Penemuan itu mengubah segalanya. Lament bukan bencana alami, melainkan akibat dari eksperimen yang melampaui batas. Peradaban lama mencoba menguasai resonansi sempurna, dan dunia membayar harganya.</p>
                                <p>Di kedalaman reruntuhan, kamu menemukan ruang tersembunyi dengan perangkat yang masih aktif. Saat menyentuhnya, ingatan-ingatan asing membanjiri pikiranmu. Kamu melihat wajah-wajah dari masa lalu, mendengar suara yang sudah lama hilang.</p>
                                <div class="mt-4 p-3 bg-dark rounded">
                                    <small class="text-white-50"><i class="bi bi-lightbulb me-1"></i> <strong>Penemuan Penting:</strong> Era Resonansi adalah zaman keemasan teknologi suara yang berakhir tragis dengan Lament.</small>
                                </div>`
                    }
                ],
                characterStories: [
                    {
                        name: "Jiyan",
                        title: "Sang Pengawal",
                        excerpt: "Komandan Pengawal Huanglong yang setia namun menyimpan luka masa lalu.",
                        content: `<p>Jiyan kehilangan keluarganya selama peristiwa Lament. Ayahnya adalah seorang peneliti resonansi terkemuka, dan ibunya seorang diplomat yang bekerja untuk perdamaian antar kota.</p>
                                <p>"Aku berjanji pada mereka," kata Jiyan suatu malam di menara pengawas. "Aku akan melindungi siapapun yang masih tersisa."</p>
                                <p>Janjinya untuk melindungi Huanglong bukan hanya tugas, melainkan penebusan dosa. Setiap nyawa yang dia selamatkan adalah pengampunan untuk yang tidak bisa dia lindungi.</p>
                                <p>Hubungannya dengan Rover kompleks. Mereka pernah bertarung di sisi yang berseberangan sebelum Lament, tetapi kini dipersatukan oleh misi yang sama: melindungi sisa-sisa kemanusiaan.</p>
                                <div class="mt-3">
                                    <span class="badge bg-info me-2">Loyal</span>
                                    <span class="badge bg-warning text-dark me-2">Protective</span>
                                    <span class="badge bg-secondary">Haunted by Past</span>
                                </div>`
                    },
                    {
                        name: "Rover",
                        title: "Penuntun Misterius",
                        excerpt: "Resonator berpengalaman yang menemukanmu dan menjadi penuntun perjalananmu.",
                        content: `<p>Rover muncul seperti hantu di tengah reruntuhan, tanpa masa lalu yang jelas. Dia mengenal dunia pasca-Lament lebih baik daripada siapa pun, tetapi jarang membicarakan dari mana pengetahuannya berasal.</p>
                                <p>"Aku hanya penuntun," katanya selalu ketika ditanya tentang identitasnya. "Tujuanmu lebih penting daripada ceritaku."</p>
                                <p>Meski selalu membantu, ada jarak yang dia jaga. Matanya kadang memandang jauh, seolah mengingat sesuatuâ€”atau seseorangâ€”yang telah lama hilang.</p>
                                <p>Kemampuan resonansinya berbeda dengan Resonator lain. Dia bisa "mendengar" sejarah sebuah tempat, merasakan gema peristiwa masa lalu yang tertinggal di gelombang suara. Beberapa menduga dia adalah korban selamat dari Era Resonansi.</p>
                                <div class="mt-3">
                                    <span class="badge bg-primary me-2">Mysterious</span>
                                    <span class="badge bg-success me-2">Guide</span>
                                    <span class="badge bg-dark">Ancient Knowledge</span>
                                </div>`
                    }
                ]
            },
            'reverse-1999': {
                title: "Reverse: 1999",
                slug: "reverse-1999",
                description: "Game time-travel strategic RPG dengan cerita misterius di tahun 1999. Jelajahi misteri di balik 'The Storm' yang mengancam keberadaan waktu itu sendiri.",
                thumbnailURL: "assets/img/games/wuthering-waves.jpg",
                logoURL: "assets/img/games/logo-wuthering-waves.jpg",
                status: "Ongoing",
                releaseDate: "26 Oktober 2023",
                genre: "Time Travel, Strategy, RPG",
                platform: "PC, iOS, Android",
                badges: ["Time Travel", "Strategy", "Mystery", "Gacha"]
            }
        };

        // Fungsi untuk handle sidebar navigation
        function handleSidebarNavigation(sectionId, linkElement) {
            // Scroll ke section
            if (window.scrollToSection) {
                window.scrollToSection(sectionId);
            }
            
            // Update active state di sidebar
            document.querySelectorAll('.sidebar-menu li a').forEach(link => {
                link.classList.remove('active');
                link.setAttribute('aria-current', null);
            });
            
            if (linkElement) {
                linkElement.classList.add('active');
                linkElement.setAttribute('aria-current', 'page');
            }
            
            // Highlight section yang dituju
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('section-highlight');
                setTimeout(() => {
                    section.classList.remove('section-highlight');
                }, 2000);
            }
            
            // Update URL hash tanpa reload page
            history.pushState(null, null, `#${sectionId}`);
            
            // Tutup sidebar di mobile
            if (window.innerWidth < 768) {
                if (typeof closeSidebar === 'function') {
                    closeSidebar();
                }
            }
            
            return false; // Prevent default anchor behavior
        }

        // Fungsi untuk load game data
        async function loadGameData() {
            const urlParams = new URLSearchParams(window.location.search);
            const gameSlug = urlParams.get('slug') || 'wuthering-waves';
            
            console.log('ðŸŽ® Loading game:', gameSlug);
            
            // Coba load dari Firestore terlebih dahulu
            try {
                if (typeof db !== 'undefined') {
                    console.log('ðŸ“¡ Trying to load from Firestore...');
                    const querySnapshot = await db.collection("games")
                        .where("slug", "==", gameSlug)
                        .get();
                    
                    if (!querySnapshot.empty) {
                        // Data ditemukan di Firestore
                        const gameDoc = querySnapshot.docs[0];
                        const game = gameDoc.data();
                        console.log('âœ… Game loaded from Firestore:', game.title);
                        renderGame(game);
                        return;
                    }
                }
            } catch (error) {
                console.warn('âš ï¸ Firestore error, using static data:', error);
            }
            
            // Fallback ke data statis
            console.log('ðŸ”„ Using static data for:', gameSlug);
            const staticGame = staticGamesData[gameSlug] || staticGamesData['wuthering-waves'];
            renderGame(staticGame);
        }

        // Fungsi render game
        function renderGame(game) {
            // Update judul halaman
            document.title = `${game.title} - Exeloth Codex`;
            
            // Update elemen-elemen utama
            document.getElementById('game-title').textContent = game.title;
            document.getElementById('game-description').textContent = game.description;
            document.getElementById('release-info').textContent = game.releaseDate || 'TBA';
            document.getElementById('game-genre').textContent = game.genre || 'Action RPG';
            document.getElementById('game-platform').textContent = game.platform || 'Multi-platform';
            
            // Update logo jika ada
            const logoImg = document.getElementById('game-logo');
            if (logoImg && game.logoURL) {
                logoImg.src = game.logoURL;
                logoImg.alt = `${game.title} Logo`;
                logoImg.onerror = function() {
                    this.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(game.title)}&background=6f42c1&color=fff`;
                };
            }
            
            // Render badges
            const badgesContainer = document.getElementById('game-badges');
            if (badgesContainer && game.badges) {
                badgesContainer.innerHTML = '';
                game.badges.forEach(badge => {
                    const badgeElement = document.createElement('span');
                    badgeElement.className = 'badge bg-primary game-badge';
                    badgeElement.textContent = badge;
                    badgeElement.setAttribute('aria-label', badge);
                    badgesContainer.appendChild(badgeElement);
                });
            }
            
            // Render main story
            const mainStoryContainer = document.getElementById('main-story-content');
            if (mainStoryContainer && game.mainStory) {
                mainStoryContainer.innerHTML = '';
                game.mainStory.forEach(chapter => {
                    const chapterElement = document.createElement('div');
                    chapterElement.className = 'chapter-card';
                    chapterElement.setAttribute('role', 'button');
                    chapterElement.setAttribute('tabindex', '0');
                    chapterElement.setAttribute('aria-label', `Read ${chapter.title}`);
                    chapterElement.onclick = () => showChapterModal(chapter);
                    chapterElement.onkeypress = (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            showChapterModal(chapter);
                        }
                    };
                    
                    chapterElement.innerHTML = `
                        <div class="chapter-title">${chapter.title}</div>
                        <div class="chapter-excerpt">${chapter.excerpt}</div>
                        <div class="text-end mt-3">
                            <span class="badge bg-secondary">Baca Selengkapnya</span>
                        </div>
                    `;
                    mainStoryContainer.appendChild(chapterElement);
                });
                
                // Jika tidak ada cerita
                if (game.mainStory.length === 0) {
                    mainStoryContainer.innerHTML = `
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            Belum ada konten cerita utama untuk game ini.
                        </div>
                    `;
                }
            } else if (mainStoryContainer) {
                mainStoryContainer.innerHTML = `
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        Belum ada konten cerita utama untuk game ini.
                    </div>
                `;
            }
            
            // Render character stories jika ada
            const charContainer = document.getElementById('character-story-content');
            if (game.characterStories && game.characterStories.length > 0) {
                charContainer.innerHTML = '<div class="row" id="character-stories-row"></div>';
                
                game.characterStories.forEach(character => {
                    const col = document.createElement('div');
                    col.className = 'col-md-6 mb-3';
                    col.innerHTML = `
                        <div class="card bg-dark border-secondary h-100">
                            <div class="card-body">
                                <h5 class="card-title text-white">${character.name}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">${character.title}</h6>
                                <p class="card-text text-white-50">${character.excerpt}</p>
                                <button class="btn btn-sm btn-outline-info mt-2" 
                                        onclick="showCharacterModal('${character.name.replace(/'/g, "\\'")}', '${character.title.replace(/'/g, "\\'")}', '${character.content.replace(/'/g, "\\'").replace(/\n/g, ' ')}')"
                                        aria-label="View ${character.name} details">
                                    <i class="bi bi-person me-1"></i> Detail
                                </button>
                            </div>
                        </div>
                    `;
                    document.getElementById('character-stories-row').appendChild(col);
                });
            } else if (charContainer) {
                charContainer.innerHTML = `
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        Belum ada konten cerita karakter untuk game ini.
                    </div>
                `;
            }
            
            // Setup intersection observer untuk active menu tracking
            setupSectionObserver();
        }

        // Fungsi untuk menampilkan modal chapter
        function showChapterModal(chapter) {
            document.getElementById('chapterModalTitle').textContent = chapter.title;
            document.getElementById('chapterModalContent').innerHTML = `
                <div class="chapter-content">
                    ${chapter.content}
                    <div class="mt-4 pt-3 border-top border-secondary">
                        <small class="text-white-50">
                            <i class="bi bi-clock-history me-1"></i> 
                            Waktu baca: ${Math.ceil(chapter.content.split(' ').length / 200)} menit
                        </small>
                    </div>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('chapterModal'));
            modal.show();
            
            // Focus trap untuk accessibility
            const modalElement = document.getElementById('chapterModal');
            modalElement.addEventListener('shown.bs.modal', function() {
                this.querySelector('.btn-close').focus();
            });
        }

        // Fungsi untuk menampilkan modal karakter
        function showCharacterModal(name, title, content) {
            document.getElementById('chapterModalTitle').textContent = `${name} - ${title}`;
            document.getElementById('chapterModalContent').innerHTML = `
                <div class="character-modal">
                    <div class="text-center mb-4">
                        <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center" 
                             style="width: 80px; height: 80px;">
                            <i class="bi bi-person-fill fs-1 text-white"></i>
                        </div>
                    </div>
                    <h4 class="text-white text-center mb-3">${name}</h4>
                    <h6 class="text-info text-center mb-4">${title}</h6>
                    <div class="character-content text-white-50">
                        <p>${content}</p>
                    </div>
                    <div class="mt-4 pt-3 border-top border-secondary text-center">
                        <small class="text-white-50">
                            <i class="bi bi-tag me-1"></i> 
                            Karakter utama dalam cerita
                        </small>
                    </div>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('chapterModal'));
            modal.show();
        }

        // Setup intersection observer untuk track section yang aktif
        function setupSectionObserver() {
            const sections = document.querySelectorAll('section[id]');
            const menuLinks = document.querySelectorAll('.sidebar-menu li a');
            
            const observerOptions = {
                root: null,
                rootMargin: '-20% 0px -70% 0px',
                threshold: 0
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const sectionId = entry.target.id;
                        // Update active menu
                        menuLinks.forEach(link => {
                            link.classList.remove('active');
                            link.setAttribute('aria-current', null);
                            if (link.getAttribute('href') === `#${sectionId}`) {
                                link.classList.add('active');
                                link.setAttribute('aria-current', 'page');
                            }
                        });
                    }
                });
            }, observerOptions);
            
            sections.forEach(section => {
                observer.observe(section);
            });
        }

        // Setup favorite button
        window.toggleFavorite = function() {
            const btn = document.getElementById('favorite-btn');
            const icon = document.getElementById('favorite-icon');
            const text = document.getElementById('favorite-text');
            
            const isActive = btn.classList.contains('active');
            
            if (isActive) {
                btn.classList.remove('active');
                icon.classList.remove('bi-star-fill');
                icon.classList.add('bi-star');
                text.textContent = 'Favorit';
                if (typeof showNotification === 'function') {
                    showNotification('Removed from favorites', 'info');
                }
            } else {
                btn.classList.add('active');
                icon.classList.remove('bi-star');
                icon.classList.add('bi-star-fill');
                text.textContent = 'Favorited';
                if (typeof showNotification === 'function') {
                    showNotification('Added to favorites', 'success');
                }
            }
            
            // Simpan ke localStorage
            const gameSlug = new URLSearchParams(window.location.search).get('slug') || 'wuthering-waves';
            const favorites = JSON.parse(localStorage.getItem('gameFavorites') || '{}');
            favorites[gameSlug] = !isActive;
            localStorage.setItem('gameFavorites', JSON.stringify(favorites));
            
            // Dispatch event untuk update UI lain jika diperlukan
            document.dispatchEvent(new CustomEvent('favorite:toggled', { 
                detail: { slug: gameSlug, isFavorite: !isActive }
            }));
        };

        // Load favorite state dari localStorage
        function loadFavoriteState() {
            const gameSlug = new URLSearchParams(window.location.search).get('slug') || 'wuthering-waves';
            const favorites = JSON.parse(localStorage.getItem('gameFavorites') || '{}');
            const isFavorited = favorites[gameSlug] || false;
            
            const btn = document.getElementById('favorite-btn');
            const icon = document.getElementById('favorite-icon');
            const text = document.getElementById('favorite-text');
            
            if (isFavorited && btn && icon && text) {
                btn.classList.add('active');
                icon.classList.remove('bi-star');
                icon.classList.add('bi-star-fill');
                text.textContent = 'Favorited';
            }
        }

        // Setup sidebar navigation
        function setupSidebarNavigation() {
            document.querySelectorAll('.sidebar-menu li a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const href = this.getAttribute('href');
                    if (href && href.startsWith('#')) {
                        const targetId = href.substring(1);
                        handleSidebarNavigation(targetId, this);
                    }
                });
                
                // Keyboard navigation
                link.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
        }

        // Initialize game page
        function initGamePage() {
            console.log('ðŸŽ® Game page initialized with Firebase-style sidebar');
            
            // Setup sidebar navigation
            setupSidebarNavigation();
            
            // Load game data (dengan fallback)
            loadGameData();
            
            // Load favorite state
            loadFavoriteState();
            
            // Check URL hash untuk auto-scroll
            if (window.location.hash) {
                const sectionId = window.location.hash.substring(1);
                setTimeout(() => {
                    if (window.scrollToSection) {
                        window.scrollToSection(sectionId);
                    }
                }, 800);
            }
            
            // Initialize game UI jika tersedia
            if (typeof initGamePage === 'function' && window.initGamePage !== initGamePage) {
                window.initGamePage();
            }
        }

        // Handle browser back/forward buttons
        window.addEventListener('popstate', function() {
            if (window.location.hash) {
                const sectionId = window.location.hash.substring(1);
                if (window.scrollToSection) {
                    setTimeout(() => {
                        window.scrollToSection(sectionId);
                    }, 100);
                }
            }
        });

        // Initialize ketika halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸ“„ Game page DOM loaded');
            
            // Tunggu sebentar untuk memastikan semua script loaded
            setTimeout(initGamePage, 300);
        });

        // Export functions untuk akses global
        window.showChapterModal = showChapterModal;
        window.showCharacterModal = showCharacterModal;
        window.handleSidebarNavigation = handleSidebarNavigation;
        window.loadGameData = loadGameData;
        window.toggleFavorite = toggleFavorite;
    </script>

</body>
</html>